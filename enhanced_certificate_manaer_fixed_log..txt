enhanced_certificate_manaer_fixed.py log

PS D:\Doc\File python\Finanza\Certificates\Revisione2> & C:/Users/namad/AppData/Local/Programs/Python/Python313/python.exe "d:/Doc/File python/Finanza/Certificates/Revisione2/enhanced_certificate_manager_fixed.py"
ENHANCED CERTIFICATE MANAGER - VERSIONE CORRETTA v15
Sistema completo con tutte le correzioni integrate
======================================================================

🧪 TEST ENHANCED CERTIFICATE MANAGER v15
============================================================
1. Inizializzazione manager v15...
2025-07-01 17:20:18,849 - INFO - EnhancedExcelExporter inizializzato
2025-07-01 17:20:18,849 - INFO - UnifiedRiskAnalyzer inizializzato
2025-07-01 17:20:18,849 - INFO - UnifiedStressTestEngine inizializzato con 7 scenari
2025-07-01 17:20:18,849 - INFO - UnifiedComplianceChecker inizializzato
2025-07-01 17:20:18,850 - INFO - UnifiedRiskAnalyzer inizializzato
2025-07-01 17:20:18,850 - INFO - UnifiedStressTestEngine inizializzato con 7 scenari
2025-07-01 17:20:18,850 - INFO - UnifiedComplianceChecker inizializzato
2025-07-01 17:20:18,850 - INFO - UnifiedRiskDashboard inizializzato
🚀 Sistema Certificati Integrato inizializzato
📁 Output Excel: D:/Doc/File python/
📂 Caricamento configurazioni v15: 5 certificati
   🔄 Conversione da formato legacy
🔄 === CONVERSIONE SAFE v15.1 (Enhanced Manager) ===
📊 Input keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'coupon_rate', 'coupon_frequency', 'currency', 'memory_feature', 'airbag_feature', 'airbag_level', 'airbag_notes', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level', 'observation_delay_months', 'note_barriere', 'yahoo_ticker', 'underlying_names', 'underlying_currencies', 'underlying_dependency_type', 'dynamic_barrier_feature']
🔧 Campi esclusi v15.1: ['coupon_rate', 'coupon_frequency', 'airbag_feature', 'airbag_level', 'airbag_notes', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'observation_delay_months', 'note_barriere']
❌ ERRORE CRITICO creazione RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'
📊 Filtered config keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'currency', 'memory_feature', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level', 'yahoo_ticker', 'underlying_names', 'underlying_currencies', 'underlying_dependency_type', 'dynamic_barrier_feature']
   isin: <class 'str'> = IT0006767872
   name: <class 'str'> = Autocallable Worst-of Reverse Convertible Certificate correlato a un paniere di azioni ordinarie
   certificate_instrument_ticker: <class 'str'> = I76787.TI
   issuer: <class 'str'> = Marex
   certificate_type: <class 'str'> = express
   issue_date: <class 'datetime.datetime'> = 2025-03-08 00:00:00
   maturity_date: <class 'datetime.datetime'> = 2030-02-28 00:00:00
   notional: <class 'float'> = 1000.0
   risk_free_rate: <class 'float'> = 0.035
   currency: <class 'str'> = EUR
   memory_feature: <class 'bool'> = True
   dynamic_barrier_start_level: <class 'float'> = 1.0
   step_down_rate: <class 'float'> = 0.005
   dynamic_barrier_end_level: <class 'float'> = 0.73
   yahoo_ticker: <class 'str'> = DBK.DE,GLE.PA,UCG.MI,BIMI.MI
   underlying_names: <class 'str'> = Deutsche Bank AG, Società Generale, Unicredit, Banco BPM
   underlying_currencies: <class 'str'> = Eur, Eur,Eur,Eur
   underlying_dependency_type: <class 'str'> = Worst-Of
   dynamic_barrier_feature: <class 'bool'> = True
   ❌ Errore caricamento IT0006767872: Impossibile creare RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'    
   🔄 Conversione da formato legacy
🔄 === CONVERSIONE SAFE v15.1 (Enhanced Manager) ===
📊 Input keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'coupon_rate', 'coupon_frequency', 'currency', 'memory_feature', 'airbag_feature', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level', 'observation_delay_months', 'yahoo_ticker', 'underlying_names', 'underlying_currencies', 'underlying_dependency_type', 'dynamic_barrier_feature', 'coupon_dates', 'coupon_rates', 'autocall_levels']
🔧 Campi esclusi v15.1: ['coupon_rate', 'coupon_frequency', 'airbag_feature', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'observation_delay_months']
❌ ERRORE CRITICO creazione RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'
📊 Filtered config keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'currency', 'memory_feature', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level', 'yahoo_ticker', 'underlying_names', 'underlying_currencies', 'underlying_dependency_type', 'dynamic_barrier_feature', 'coupon_dates', 'coupon_rates', 'autocall_levels']
   isin: <class 'str'> = XS3031184206
   name: <class 'str'> = Fast Casch Collect
   certificate_instrument_ticker: <class 'str'> = B18420.TI
   issuer: <class 'str'> = BNP Paribas
   certificate_type: <class 'str'> = cash_collect
   issue_date: <class 'datetime.datetime'> = 2025-05-21 00:00:00
   maturity_date: <class 'datetime.datetime'> = 2027-05-24 00:00:00
   notional: <class 'float'> = 100.0
   risk_free_rate: <class 'float'> = 0.03
   currency: <class 'str'> = EUR
   memory_feature: <class 'bool'> = True
   dynamic_barrier_start_level: <class 'float'> = 0.95
   step_down_rate: <class 'float'> = 0.01
   dynamic_barrier_end_level: <class 'float'> = 0.75
   yahoo_ticker: <class 'str'> = STLAM.MI,CPR.MI,NEXI.MI, STMMI.MI
   underlying_names: <class 'str'> = Stellantis NV, Davide campari, Nexi StMicroelettronics
   underlying_currencies: <class 'str'> = EUR, EUR, EUR, EUR
   underlying_dependency_type: <class 'str'> = Worst-Of
   dynamic_barrier_feature: <class 'bool'> = True
   coupon_dates: <class 'list'> = []
   coupon_rates: <class 'list'> = []
   autocall_levels: <class 'list'> = []
   ❌ Errore caricamento XS3031184206: Impossibile creare RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'    
   🔄 Conversione da formato legacy
🔄 === CONVERSIONE SAFE v15.1 (Enhanced Manager) ===
📊 Input keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'coupon_rate', 'coupon_frequency', 'currency', 'memory_feature', 'airbag_feature', 'airbag_notes', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level', 'observation_delay_months', 'yahoo_ticker', 'underlying_names', 'underlying_currencies', 'underlying_dependency_type', 'dynamic_barrier_feature', 'coupon_dates', 'coupon_rates', 'autocall_levels']
🔧 Campi esclusi v15.1: ['coupon_rate', 'coupon_frequency', 'airbag_feature', 'airbag_notes', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'observation_delay_months']
❌ ERRORE CRITICO creazione RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'
📊 Filtered config keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'currency', 'memory_feature', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level', 'yahoo_ticker', 'underlying_names', 'underlying_currencies', 'underlying_dependency_type', 'dynamic_barrier_feature', 'coupon_dates', 'coupon_rates', 'autocall_levels']
   isin: <class 'str'> = DE000VK2NM23
   name: <class 'str'> = MEMORY MULTI CASH COLLECT BARRIER EXPRESS
   certificate_instrument_ticker: <class 'str'> = F70170.MI
   issuer: <class 'str'> = Vontobel
   certificate_type: <class 'str'> = express
   issue_date: <class 'datetime.datetime'> = 2025-05-16 00:00:00
   maturity_date: <class 'datetime.datetime'> = 2027-05-14 00:00:00
   notional: <class 'float'> = 100.0
   risk_free_rate: <class 'float'> = 0.03
   currency: <class 'str'> = EUR
   memory_feature: <class 'bool'> = True
   dynamic_barrier_start_level: <class 'float'> = 0.95
   step_down_rate: <class 'float'> = 0.01
   dynamic_barrier_end_level: <class 'float'> = 0.75
   yahoo_ticker: <class 'str'> = BMW.DE, MBG.DE,STLAM.MI,VOW.DE
   underlying_names: <class 'str'> = Bayerische Motoren Werke AG, Mercedes-Benz Group AG,, Stellantis N.V., Volkswagen AG
   underlying_currencies: <class 'str'> = EUR, EUR, EUR, EUR
   underlying_dependency_type: <class 'str'> = Worst-Of
   dynamic_barrier_feature: <class 'bool'> = True
   coupon_dates: <class 'list'> = []
   coupon_rates: <class 'list'> = []
   autocall_levels: <class 'list'> = []
   ❌ Errore caricamento DE000VK2NM23: Impossibile creare RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'    
   🔄 Conversione da formato legacy
🔄 === CONVERSIONE SAFE v15.1 (Enhanced Manager) ===
📊 Input keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'coupon_rate', 'coupon_frequency', 'currency', 'memory_feature', 'airbag_feature', 'airbag_notes', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level', 'observation_delay_months', 'yahoo_ticker', 'underlying_names', 'underlying_currencies', 'underlying_dependency_type', 'dynamic_barrier_feature', 'coupon_dates', 'coupon_rates', 'autocall_levels']
🔧 Campi esclusi v15.1: ['coupon_rate', 'coupon_frequency', 'airbag_feature', 'airbag_notes', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'observation_delay_months']
❌ ERRORE CRITICO creazione RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'
📊 Filtered config keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'currency', 'memory_feature', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level', 'yahoo_ticker', 'underlying_names', 'underlying_currencies', 'underlying_dependency_type', 'dynamic_barrier_feature', 'coupon_dates', 'coupon_rates', 'autocall_levels']
   isin: <class 'str'> = XS2902921233
   name: <class 'str'> = Autocallable Barrier Worst-of Phoenix
   certificate_instrument_ticker: <class 'str'> = BA2123.TI
   issuer: <class 'str'> = Altro
   certificate_type: <class 'str'> = express
   issue_date: <class 'datetime.datetime'> = 2024-11-26 00:00:00
   maturity_date: <class 'datetime.datetime'> = 2027-11-29 00:00:00
   notional: <class 'float'> = 100.0
   risk_free_rate: <class 'float'> = 0.03
   currency: <class 'str'> = EUR
   memory_feature: <class 'bool'> = False
   dynamic_barrier_start_level: <class 'float'> = 0.6
   step_down_rate: <class 'float'> = 0.0
   dynamic_barrier_end_level: <class 'float'> = 0.6
   yahoo_ticker: <class 'str'> = BMPS.MI, BAMI.MI, BPE.MI
   underlying_names: <class 'str'> = Banca Monte Paschi, Banco BPM, Bper Banca
   underlying_currencies: <class 'str'> = EUR, EUR, EUR
   underlying_dependency_type: <class 'str'> = Worst-Of
   dynamic_barrier_feature: <class 'bool'> = True
   coupon_dates: <class 'list'> = []
   coupon_rates: <class 'list'> = []
   autocall_levels: <class 'list'> = []
   ❌ Errore caricamento XS2902921233: Impossibile creare RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'    
   🔄 Conversione da formato legacy
🔄 === CONVERSIONE SAFE v15.1 (Enhanced Manager) ===
📊 Input keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'coupon_rate', 'coupon_frequency', 'currency', 'memory_feature', 'airbag_feature', 'airbag_notes', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type', 'yahoo_ticker', 'underlying_names', 'underlying_dependency_type', 'dynamic_barrier_feature', 'coupon_dates', 'coupon_rates', 'autocall_levels', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level']
🔧 Campi esclusi v15.1: ['coupon_rate', 'coupon_frequency', 'airbag_feature', 'airbag_notes', 'coupon_barrier', 'coupon_barrier_type', 'capital_barrier', 'capital_barrier_type']       
❌ ERRORE CRITICO creazione RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'
📊 Filtered config keys: ['isin', 'name', 'certificate_instrument_ticker', 'issuer', 'certificate_type', 'issue_date', 'maturity_date', 'notional', 'risk_free_rate', 'currency', 'memory_feature', 'yahoo_ticker', 'underlying_names', 'underlying_dependency_type', 'dynamic_barrier_feature', 'coupon_dates', 'coupon_rates', 'autocall_levels', 'dynamic_barrier_start_level', 'step_down_rate', 'dynamic_barrier_end_level']
   isin: <class 'str'> = XS2705561756
   name: <class 'str'> = CAPITAL PROTECTION WITH PREMIUM
   certificate_instrument_ticker: <class 'str'> = I09742.MI
   issuer: <class 'str'> = Altro
   certificate_type: <class 'str'> = phoenix
   issue_date: <class 'datetime.datetime'> = 2023-11-30 00:00:00
   maturity_date: <class 'datetime.datetime'> = 2026-11-30 00:00:00
   notional: <class 'float'> = 1000.0
   risk_free_rate: <class 'float'> = 0.03
   currency: <class 'str'> = EUR
   memory_feature: <class 'bool'> = True
   yahoo_ticker: <class 'str'> = ^GSPC, ^STOXX50E, ^N225
   underlying_names: <class 'str'> = S&P 500, EURO STOXX 50, NIKKEI 225
   underlying_dependency_type: <class 'str'> = Single
   dynamic_barrier_feature: <class 'bool'> = False
   coupon_dates: <class 'list'> = []
   coupon_rates: <class 'list'> = []
   autocall_levels: <class 'list'> = []
   dynamic_barrier_start_level: <class 'NoneType'> = None
   step_down_rate: <class 'NoneType'> = None
   dynamic_barrier_end_level: <class 'NoneType'> = None
   ❌ Errore caricamento XS2705561756: Impossibile creare RealCertificateConfig: RealCertificateConfig.__init__() got an unexpected keyword argument 'certificate_instrument_ticker'    
🚀 Enhanced Certificate Manager v15 inizializzato
   Directory: D:\Doc\File python\Finanza\Certificates\Revisione2\configs
   Certificati: 0
   Portfolio: 0
   Versione: v15 (CORRETTA)
2. Test aggiunta certificato con yahoo_ticker...
🆕 Aggiunta certificato v15: TEST123456789
   Dati ricevuti: ['isin', 'name', 'certificate_type', 'issuer', 'yahoo_ticker', 'underlying_assets', 'issue_date', 'maturity_date', 'notional', 'currency', 'memory_feature', 'auto_update_market_data', 'current_spots', 'volatilities', 'risk_free_rate', 'coupon_rate', 'coupon_dates', 'barrier_levels']
   📊 Yahoo ticker specificato: TEST.MI
🔄 === CONVERSIONE SAFE v15.1 (Enhanced Manager) ===
📊 Input keys: ['isin', 'name', 'certificate_type', 'issuer', 'yahoo_ticker', 'underlying_assets', 'issue_date', 'maturity_date', 'notional', 'currency', 'memory_feature', 'auto_update_market_data', 'current_spots', 'volatilities', 'risk_free_rate', 'coupon_rate', 'coupon_dates', 'barrier_levels']
🔧 Campi esclusi v15.1: ['auto_update_market_data', 'coupon_rate']
✅ RealCertificateConfig creato (Enhanced Manager v15.1)
📊 Campi utilizzati: 16
🔄 Backup creato: certificates_v15.backup_20250701_172018.json
💾 Configurazioni v15 salvate: 1 certificati
✅ Certificato enhanced TEST123456789 aggiunto (v15)
   ✅ Yahoo ticker salvato: TEST.MI
3. Test calcolo date robusto...
📅 Calcolo date cedole v15 per TEST123456789
   Frequency: Trimestrale
   Period rate: 0.0250
📅 Calcolo date robusto v15:
   Start: 2024-01-15
   End: 2029-01-15
   Frequency: Trimestrale
   Primo periodo: 2024-04-15
   Data generata: 2024-04-15
   Data generata: 2024-07-15
   Data generata: 2024-10-15
   Data generata: 2025-01-15
   Data generata: 2025-04-15
   Data generata: 2025-07-15
   Data generata: 2025-10-15
   Data generata: 2026-01-15
   Data generata: 2026-04-15
   Data generata: 2026-07-15
   Data generata: 2026-10-15
   Data generata: 2027-01-15
   Data generata: 2027-04-15
   Data generata: 2027-07-15
   Data generata: 2027-10-15
   Data generata: 2028-01-15
   Data generata: 2028-04-15
   Data generata: 2028-07-15
   Data generata: 2028-10-15
   Data generata: 2029-01-15
   Data generata: 2029-04-15
   Fermato: data supera end_date
📊 Totale 20 date cedole generate (robusto v15)
🔄 Backup creato: certificates_v15.backup_20250701_172018.json
💾 Configurazioni v15 salvate: 1 certificati
✅ Calcolate 20 date cedole
   Tasso periodo: 2.50%
   Tasso annuo equivalente: 10.00%
   ✅ Generate 20 date cedole
4. Test stato in-life...
🔄 Backup creato: certificates_v15.backup_20250701_172018.json
💾 Configurazioni v15 salvate: 1 certificati
✅ Stato in-life aggiornato per TEST123456789 (v15)
   Valuation Date: 2025-06-15
   Paid Coupons: 2
   Memory Coupons: 1
   ✅ Stato in-life aggiornato
5. Test lista dettagliata...
   ✅ Lista dettagliata: 1 certificati
6. Test save/load...
🔄 Backup creato: certificates_v15.backup_20250701_172018.json
💾 Configurazioni v15 salvate: 1 certificati
2025-07-01 17:20:18,877 - INFO - EnhancedExcelExporter inizializzato
2025-07-01 17:20:18,877 - INFO - UnifiedRiskAnalyzer inizializzato
2025-07-01 17:20:18,877 - INFO - UnifiedStressTestEngine inizializzato con 7 scenari
2025-07-01 17:20:18,877 - INFO - UnifiedComplianceChecker inizializzato
2025-07-01 17:20:18,878 - INFO - UnifiedRiskAnalyzer inizializzato
2025-07-01 17:20:18,878 - INFO - UnifiedStressTestEngine inizializzato con 7 scenari
2025-07-01 17:20:18,878 - INFO - UnifiedComplianceChecker inizializzato
2025-07-01 17:20:18,878 - INFO - UnifiedRiskDashboard inizializzato
🚀 Sistema Certificati Integrato inizializzato
📁 Output Excel: D:/Doc/File python/
📂 Caricamento configurazioni v15: 1 certificati
🔄 === CONVERSIONE SAFE v15.1 (Enhanced Manager) ===
📊 Input keys: ['isin', 'name', 'certificate_type', 'issuer', 'underlying_assets', 'issue_date', 'maturity_date', 'notional', 'currency', 'yahoo_ticker', 'coupon_rates', 'coupon_dates', 'autocall_levels', 'autocall_dates', 'barrier_levels', 'memory_feature', 'current_spots', 'volatilities', 'correlations', 'risk_free_rate', 'dividend_yields']
🔧 Campi esclusi v15.1: []
✅ RealCertificateConfig creato (Enhanced Manager v15.1)
📊 Campi utilizzati: 21
   ✅ TEST123456789 caricato
🚀 Enhanced Certificate Manager v15 inizializzato
   Directory: D:\Doc\File python\Finanza\Certificates\Revisione2\configs
   Certificati: 1
   Portfolio: 0
   Versione: v15 (CORRETTA)
   ✅ Certificato caricato con yahoo_ticker: TEST.MI

🎉 TUTTI I TEST v15 PASSATI!

✅ ENHANCED CERTIFICATE MANAGER v15 PRONTO!

CORREZIONI INTEGRATE:
✅ yahoo_ticker opzionale supportato
✅ Fix errore 'day out of range' nel calcolo date
✅ Dimensioni finestre calcolo date corrette
✅ Valori default caricati dal certificato selezionato
✅ Gestione robusta errori Yahoo Finance
✅ Validazione completa dati input
✅ Backward compatibility con configurazioni esistenti

🔗 INTEGRAZIONE CON GUI v14:
# Sostituisci _auto_calculate_dates nel tuo GUI v14
enhanced_manager = EnhancedCertificateManagerV15()
# Usa CalculoDateAutoDialogV15 invece del dialog esistente
PS D:\Doc\File python\Finanza\Certificates\Revisione2> 